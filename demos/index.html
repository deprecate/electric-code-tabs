<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Demo: Electric Code Mirror</title>

	<link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.css">
	<link rel="stylesheet" href="../build/electric-code-mirror.css">
	<link rel="stylesheet" href="../node_modules/codemirror/lib/codemirror.css">

	<script src="../node_modules/codemirror/lib/codemirror.js"></script>
	<script src="../build/globals/electric-code-mirror.js"></script>
</head>
<body>
	<h1>Electric Code Mirror</h1>

	<div class="code-container">
		<pre>
			<code class="code" data-mode="javascript" ref="code">
				var hi = function() {
					console.log('Hello, World!');
				};
			</code>
		</pre>
	</div>
	<div class="code-container">
		<pre>
			<code class="code" data-mode="javascript" ref="code">
				var hi = function() {
					console.log('Hello, World!!!!!!');
				};
			</code>
		</pre>
	</div>

	<script type="text/javascript">
		CodeMirror.defaults.lineNumbers = true;
		CodeMirror.defaults.matchBrackets = true;
		CodeMirror.defaults.readOnly = true;
		CodeMirror.defaults.theme = 'dracula';
		CodeMirror.defaults.viewportMargin = Infinity;
		CodeMirror.defaults.tabSize = 2;
		var REGEX_LB = /&#123;/g;
		var REGEX_RB = /&#125;/g;

		function runCodeMirror() {
			var code = document.querySelectorAll('.code');

			for (var i = 0; i < code.length; i++) {
				// Workaround for soy issue where namespace and template tags are
				// rendered inside literal blocks
				var text = code[i].innerText
					.replace(REGEX_LB, '{lb}')
					.replace(REGEX_RB, '{rb}');

				var editor = CodeMirror(function(elt) {
					var preEl = code[i].parentNode;

					preEl.parentNode.append(elt);
				}, {
					mode: code[i].getAttribute('data-mode') || '',
					value: text
				});
			}
		}
		runCodeMirror();
		new metal.ElectricCodeMirror();
	</script>
</body>
</html>
